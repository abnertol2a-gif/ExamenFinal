@model MvcMovie.Models.MovieGenreViewModel

@{
    ViewData["Title"] = "Index";
}

<div class="container mt-4">

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="fw-bold text-primary">Listado de Libros</h1>

        <a asp-action="Create" class="btn btn-primary btn-lg shadow-sm">
            ➕ Crear nuevo
        </a>
    </div>

    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <form asp-controller="Movies" asp-action="Index" method="get" class="row g-3">

                <div class="col-md-3">
                    <label class="form-label">Género</label>
                    <select asp-for="MovieGenre" asp-items="Model.Genres" class="form-select">
                        <option value="">Todos</option>
                    </select>
                </div>

                <div class="col-md-5">
                    <label class="form-label">Título</label>
                    <input type="text" asp-for="SearchString" class="form-control" placeholder="Buscar por título..." />
                </div>

                <div class="col-md-2 d-flex align-items-end">
                    <input type="submit" value="Filtrar" class="btn btn-success w-100" />
                </div>

            </form>
        </div>
    </div>

    <div class="card shadow-sm">
        <div class="card-body p-0">

            <table class="table table-striped table-hover mb-0 align-middle">
                <thead class="table-dark">
                    <tr>
                        <th>@Html.DisplayNameFor(model => model.Movies![0].Nombre)</th>
                        <th>@Html.DisplayNameFor(model => model.Movies![0].Autor)</th>
                        <th>@Html.DisplayNameFor(model => model.Movies![0].ReleaseDate)</th>
                        <th>@Html.DisplayNameFor(model => model.Movies![0].Genre)</th>
                        <th>@Html.DisplayNameFor(model => model.Movies![0].Price)</th>
                        <th>@Html.DisplayNameFor(model => model.Movies![0].Rating)</th>
                        <th>@Html.DisplayNameFor(model => model.Movies![0].Estado)</th>
                        <th class="text-center">Acciones</th>
                    </tr>
                </thead>

                <tbody>
                    @foreach (var item in Model.Movies!)
                    {
                        <tr>
                            <td>@Html.DisplayFor(modelItem => item.Nombre)</td>
                            <td>@Html.DisplayFor(modelItem => item.Autor)</td>
                            <td>@Html.DisplayFor(modelItem => item.ReleaseDate)</td>
                            <td>@Html.DisplayFor(modelItem => item.Genre)</td>
                            <td>@Html.DisplayFor(modelItem => item.Price)</td>
                            <td>@Html.DisplayFor(modelItem => item.Rating)</td>
                            <td>@Html.DisplayFor(modelItem => item.Estado)</td>

                            <td class="text-center">

                                <div class="btn-group" role="group">

                                    <a asp-action="Edit"
                                       asp-route-id="@item.Id"
                                       class="btn btn-sm btn-warning me-2">
                                        Editar
                                    </a>

                                    <a asp-action="Details"
                                       asp-route-id="@item.Id"
                                       class="btn btn-sm btn-info text-white me-2">
                                        Detalles
                                    </a>

                                    <a asp-action="Delete"
                                       asp-route-id="@item.Id"
                                       class="btn btn-sm btn-danger me-2">
                                        Eliminar
                                    </a>


                                    <!-- Botón Prestar / Devolver -->
                                    <form asp-action="ToggleEstado" method="post" class="d-inline">
                                        <input type="hidden" name="id" value="@item.Id" />

                                        @if (item.Estado == EstadoLibro.Disponible)
                                        {
                                            <button type="submit" class="btn btn-sm btn-success">
                                                Prestar
                                            </button>
                                        }
                                        else if (item.Estado == EstadoLibro.Prestado)
                                        {
                                            <button type="submit" class="btn btn-sm btn-secondary">
                                                Devolver
                                            </button>
                                        }
                                    </form>

                                </div>

                            </td>
                        </tr>
                    }
                </tbody>
            </table>

        </div>
    </div>

</div>
